var he=Object.defineProperty;var de=(n,e,t)=>e in n?he(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var y=(n,e,t)=>(de(n,typeof e!="symbol"?e+"":e,t),t),z=(n,e,t)=>{if(!e.has(n))throw TypeError("Cannot "+t)};var d=(n,e,t)=>(z(n,e,"read from private field"),t?t.call(n):e.get(n)),b=(n,e,t)=>{if(e.has(n))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(n):e.set(n,t)},j=(n,e,t,i)=>(z(n,e,"write to private field"),i?i.call(n,t):e.set(n,t),t);var p=(n,e,t)=>(z(n,e,"access private method"),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function t(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerpolicy&&(o.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?o.credentials="include":r.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(r){if(r.ep)return;r.ep=!0;const o=t(r);fetch(r.href,o)}})();var k=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},ue={},D={},W={};Object.defineProperty(W,"__esModule",{value:!0});W.setAttributes=void 0;function fe(n,e){for(const t of Object.keys(n))t in e&&(e[t]=n[t])}function pe(n,e){for(const t of Object.keys(e)){if(t==="__source"||t==="__self")continue;const i=e[t];if(t.startsWith("on")){const r=t.replace(/Capture$/,""),o=t!==r,l=r.toLowerCase().substring(2);n.addEventListener(l,i,o)}else t==="style"&&typeof i!="string"?fe(i,n.style):t==="dangerouslySetInnerHTML"?n.innerHTML=i:i===!0?n.setAttribute(t,t):(i||i===0)&&n.setAttribute(t,i.toString())}}W.setAttributes=pe;var _={};Object.defineProperty(_,"__esModule",{value:!0});_.createDomElement=_.applyChildren=void 0;function be(n,e){e instanceof Element?n.appendChild(e):typeof e=="string"||typeof e=="number"?n.appendChild(document.createTextNode(e.toString())):console.warn("Unknown type to append: ",e)}function ie(n,e){for(const t of e)!t&&t!==0||(Array.isArray(t)?ie(n,t):be(n,t))}_.applyChildren=ie;function ye(n,e){const t=e!=null&&e.is?{is:e.is}:void 0;return e!=null&&e.xmlns?document.createElementNS(e.xmlns,n,t):document.createElement(n,t)}_.createDomElement=ye;Object.defineProperty(D,"__esModule",{value:!0});D.h=D.createElement=void 0;const ve=W,Z=_;function re(n,e,...t){if(typeof n=="function")return n({...e,children:t});const i=(0,Z.createDomElement)(n,e);return e&&(0,ve.setAttributes)(i,e),(0,Z.applyChildren)(i,t),i}D.createElement=re;D.h=re;var A={};Object.defineProperty(A,"__esModule",{value:!0});A.jsxDEV=oe=A.jsxs=T=A.jsx=void 0;const ge=W,ee=_;function K(n,e){if(typeof n=="function")return n(e);const{children:t,...i}=e,r=(0,ee.createDomElement)(n,i);return i&&(0,ge.setAttributes)(r,i),(0,ee.applyChildren)(r,[t]),r}var T=A.jsx=K,oe=A.jsxs=K;A.jsxDEV=K;var se={};Object.defineProperty(se,"__esModule",{value:!0});(function(n){var e=k&&k.__createBinding||(Object.create?function(i,r,o,l){l===void 0&&(l=o);var c=Object.getOwnPropertyDescriptor(r,o);(!c||("get"in c?!r.__esModule:c.writable||c.configurable))&&(c={enumerable:!0,get:function(){return r[o]}}),Object.defineProperty(i,l,c)}:function(i,r,o,l){l===void 0&&(l=o),i[l]=r[o]}),t=k&&k.__exportStar||function(i,r){for(var o in i)o!=="default"&&!Object.prototype.hasOwnProperty.call(r,o)&&e(r,i,o)};Object.defineProperty(n,"__esModule",{value:!0}),t(D,n),t(A,n),t(se,n)})(ue);const te=(n,e,t,i)=>{const r=Math.min(n,e),l=2*(1+Math.abs(e-n)),c=t<l/2,s=c?0:-l/2,g=t+s,h=c?0:r-1,f=n>e?[h,g]:[h+g,0],a=c?[1,1]:[-1,1];return[f[0]+i*a[0],f[1]+i*a[1]]},me=(n,e)=>{let t=[-1];return n.some(function i(r){return function(o,l){return o===e?(t=r.concat(l),!0):Array.isArray(o)&&o.some(i(r.concat(l)))}}([])),t},we=n=>document.querySelector(n),Ae=(n,e,t,i={})=>{const r=new AbortController;return n.addEventListener(e,t,{passive:!0,signal:r.signal,...i}),()=>{r.abort()}},_e="O",je="X",u=n=>n;u.x=u(je);u.o=u(_e);u.empty=u(null);Object.freeze(u);var v,w,R,le,S,Y,$,ae,B,U,F,ce,C,q,x,X,L,G;const N=class{constructor({level:e,parent:t=null,board:i}){b(this,R);b(this,S);b(this,$);b(this,B);b(this,F);b(this,C);b(this,x);b(this,L);y(this,"level");b(this,v,void 0);y(this,"children");y(this,"parent");b(this,w,void 0);y(this,"board");this.level=e,j(this,v,u.empty),this.parent=t,j(this,w,!1),this.board=i,this.children=p(this,R,le).call(this)}static clone(e){return new N({level:e.level,parent:e.parent,board:e.board})}get width(){return this.board.width}get height(){return this.board.height}get isWonBy(){return d(this,v)!==null||this.level===0||d(this,w)?d(this,v):p(this,S,Y).call(this,u.empty)}get isActive(){return this.board.activeState===this}get canDoMove(){return d(this,v)!==null||d(this,w)?!1:p(this,C,q).call(this)}get canFill(){return d(this,v)===null&&!d(this,w)?d(this,x,X):!1}fill(){const e=this.board.turn;e!==null&&this.canFill&&this.hasActiveAncestor&&(p(this,L,G).call(this,e),this.board.nextTurn())}get hasActiveAncestor(){return this.parent===null?this.isActive:this.isActive||this.parent.hasActiveAncestor}};let I=N;v=new WeakMap,w=new WeakMap,R=new WeakSet,le=function(){return this.level>0?Array.from(Array(this.height)).map(e=>Array.from(Array(this.width)).map(t=>new N({level:this.level-1,parent:this,board:this.board}))):null},S=new WeakSet,Y=function(e){const t=d(this,v);if(t===null){const i=this.level===0?e:p(this,F,ce).call(this);return i!==null&&(j(this,v,i),p(this,$,ae).call(this)),i}return t},$=new WeakSet,ae=function(){var e;if(this.parent!==null){const[t,i]=me(this.parent.children,this);if(this.parent.parent!==null){const r=this.parent.parent.children[t][i];this.board.activeState=r,p(e=r,B,U).call(e)}}},B=new WeakSet,U=function(){var e;this.canDoMove||(this.board.activeState=null,this.parent!==null&&(this.board.activeState=this.parent,p(e=this.parent,B,U).call(e)))},F=new WeakSet,ce=function(){if(this.children!==null){const e=Array(this.height).fill(!0),t=Array(this.width).fill(!0),i=Math.min(this.height,this.width),r=Math.abs(this.height-this.width),o=2*(1+r),l=Array(o).fill(!0),c=(s,g)=>{e[s]=!1,t[g]=!1;const h=this.height>this.width?s-g:g-s;h>=0&&h<=r&&(l[h]=!1);const a=s+g-i+1;a>=0&&a<=r&&(l[a+o/2]=!1)};for(let s=0;s<e.length;s++){if(!e[s])continue;const h=this.width,f=this.children[s][0].isWonBy;if(f===null)c(s,0);else for(let a=1;a<h;a++){const m=this.children[s][a].isWonBy;if(m===null){c(s,a);break}if(m!==f)break;if(a===h-1)return f}}for(let s=0;s<t.length;s++){if(!t[s])continue;const h=this.height,f=this.children[0][s].isWonBy;if(f===null)c(0,s);else for(let a=1;a<h;a++){const m=this.children[a][s].isWonBy;if(m===null){c(a,s);break}if(m!==f)break;if(a===h-1)return f}}for(let s=0;s<l.length;s++){if(!l[s])continue;const h=i,[f,a]=te(this.width,this.height,s,0),m=this.children[f][a].isWonBy;if(m===null)c(f,a);else for(let P=1;P<h;P++){const[V,J]=te(this.width,this.height,s,P),Q=this.children[V][J].isWonBy;if(Q===null){c(V,J);break}if(Q!==m)break;if(P===h-1)return m}}}return d(this,v)},C=new WeakSet,q=function(){var t;const e=((t=this.children)==null?void 0:t.some(i=>i.some(r=>r.canDoMove)))??d(this,v)===null;return e||j(this,w,!0),e},x=new WeakSet,X=function(){return this.parent===null?!d(this,w):this.parent.canDoMove&&d(this.parent,x,X)},L=new WeakSet,G=function(e){var t;p(this,S,Y).call(this,e),p(this,C,q).call(this),this.parent!==null&&p(t=this.parent,L,G).call(t,e)};var E;class De{constructor({width:e,height:t,maxLevel:i}){y(this,"width");y(this,"height");y(this,"maxLevel");y(this,"rootState");y(this,"activeState");y(this,"turn",u.empty);b(this,E,null);this.width=e,this.height=t,this.maxLevel=i,this.rootState=new I({level:i,board:this}),this.activeState=this.rootState}setRenderCallback(e){j(this,E,e)}startTurn(e){this.turn=e}nextTurn(){var e;this.turn!==u.empty&&(this.turn=this.turn===u.o?u.x:u.o,(e=d(this,E))==null||e.call(this))}}E=new WeakMap;class Oe{constructor(e){y(this,"renderObject");this.renderObject=e}}var M,H;class Se extends Oe{constructor(){super(...arguments);b(this,M)}render(){const t=this.renderObject;return p(this,M,H).call(this,t.rootState)}}M=new WeakSet,H=function(t){var r;const i=document.createElement("div");return i.classList.add("cell"),i.classList.add(`level${t.level}`),t.canFill||i.classList.add("filled"),t.isWonBy!==null&&(i.classList.add("won"),i.classList.add(t.isWonBy)),t.isActive&&i.classList.add("active"),t.level===0&&Ae(i,"click",o=>{t.fill()}),t.level>0&&i.append(...((r=t.children)==null?void 0:r.flatMap(o=>o).map(o=>p(this,M,H).call(this,o)))??[]),i};const Be=n=>n,O={board:new De({width:3,height:3,maxLevel:3}),currentTurn:0,currentLevel:0},ne="board",Ce=T("div",{id:ne,children:(()=>(O.board.startTurn(u.o),function n(){const e=new Se(O.board);return O.board.setRenderCallback(()=>{var t;(t=we(`#${ne}`))==null||t.replaceChildren(n())}),e.render()}()))()}),xe=Be(oe(A.Fragment,{children:[T("h1",{children:"TTT Infinite"}),T("style",{children:`
        *, *:before, *:after {
          box-sizing: border-box;
        }

        #board {
          --width: ${O.board.width};
          --height: ${O.board.height};

          width: 540px;
          aspect-ratio: 1 / 1;
        }
        #board>.cell {
          width: 100%;
          height: 100%;
        }
        .cell {
          border: 1px solid transparent;
        }
        .cell:not(:empty) {
          display: grid;
          grid: repeat(var(--width), 1fr) / repeat(var(--height), 1fr);
        }
        .cell:empty {
          border-width: .5px;
        }
        .cell:empty:before {
          content: '';
          display: block;
          width: 100%;
          height: 100%;
          border-radius: 2px;

          --bg: #e0e0e0;
          background: var(--bg);
        }
        .cell.active:not(:where(.filled, .won)) > .cell:empty,
        .cell.active .cell:not(:where(.filled, .won)) .cell:empty {
          cursor: pointer;
        }
        .cell.active:not(:where(.filled, .won)) > .cell:empty:before,
        .cell.active .cell:not(:where(.filled, .won)) .cell:empty:before {
          --bg: #ff8;
        }
        .cell.won.O:empty:before {
          --bg: #f88 !important;
        }
        .cell.won.X:empty:before {
          --bg: #88f !important;
        }
        `}),Ce]})),Le=document.querySelector("#app");Le.append(xe);
